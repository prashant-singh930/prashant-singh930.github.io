<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Heart Disease Prediction Model</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script
      src="https://unpkg.com/react@18/umd/react.development.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"
      crossorigin
    ></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap");
      body {
        font-family: "Inter", sans-serif;
        background-color: #f8fafc;
      }
      .slide-in {
        animation: slideIn 0.5s ease-out;
      }
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      input[type="range"] {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background: transparent;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
      }
      input[type="range"]:focus {
        outline: none;
      }

      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      const IconBase = ({
        size = 24,
        className = "",
        children,
        fill = "none",
        stroke = "currentColor",
      }) => (
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width={size}
          height={size}
          viewBox="0 0 24 24"
          fill={fill}
          stroke={stroke}
          strokeWidth="2"
          strokeLinecap="round"
          strokeLinejoin="round"
          className={className}
        >
          {children}
        </svg>
      );

      const Heart = (props) => (
        <IconBase {...props}>
          <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
        </IconBase>
      );
      const Activity = (props) => (
        <IconBase {...props}>
          <path d="M22 12h-4l-3 9L9 3l-3 9H2" />
        </IconBase>
      );
      const Thermometer = (props) => (
        <IconBase {...props}>
          <path d="M14 4v10.54a4 4 0 1 1-4 0V4a2 2 0 0 1 4 0Z" />
        </IconBase>
      );
      const Wind = (props) => (
        <IconBase {...props}>
          <path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2" />
          <path d="M9.6 4.6A2 2 0 1 1 11 8H2" />
          <path d="M12.6 19.4A2 2 0 1 0 14 16H2" />
        </IconBase>
      );
      const User = (props) => (
        <IconBase {...props}>
          <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
          <circle cx="12" cy="7" r="4" />
        </IconBase>
      );
      const Zap = (props) => (
        <IconBase {...props}>
          <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
        </IconBase>
      );
      const AlertCircle = (props) => (
        <IconBase {...props}>
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="8" x2="12" y2="12" />
          <line x1="12" y1="16" x2="12.01" y2="16" />
        </IconBase>
      );
      const Info = (props) => (
        <IconBase {...props}>
          <circle cx="12" cy="12" r="10" />
          <path d="M12 16v-4" />
          <path d="M12 8h.01" />
        </IconBase>
      );

      const calculateRiskScore = (rawData) => {
        const safeNum = (val) => {
          const parsed = Number(val);
          return isNaN(parsed) ? 0 : parsed;
        };

        const data = {
          age: safeNum(rawData.age),
          sex: safeNum(rawData.sex),
          cp: safeNum(rawData.cp),
          trestbps: safeNum(rawData.trestbps),
          chol: safeNum(rawData.chol),
          fbs: safeNum(rawData.fbs),
          thalach: safeNum(rawData.thalach),
          exang: safeNum(rawData.exang),
          oldpeak: safeNum(rawData.oldpeak),
          ca: safeNum(rawData.ca),
          thal: safeNum(rawData.thal),
        };

        let score = 0;
        let riskFactors = [];

        // 1. Age
        score += (data.age - 30) * 0.05;
        if (data.age > 55) riskFactors.push("Age > 55");

        // 2. Sex
        if (data.sex === 1) score += 0.3;

        // 3. Chest Pain (CP)
        if (data.cp === 0) {
          score += 1.5;
          riskFactors.push("Typical Angina (CP Type 0)");
        } else {
          score -= 0.5;
        }

        score += (data.trestbps - 120) * 0.01;
        if (data.trestbps > 140) riskFactors.push("High Blood Pressure");

        // 5. Cholesterol
        score += (data.chol - 200) * 0.005;
        if (data.chol > 240) riskFactors.push("High Cholesterol");

        // 6. Fasting Blood Sugar
        if (data.fbs === 1) {
          score += 0.4;
          riskFactors.push("High Fasting Blood Sugar");
        }

        // 7. Exercise Induced Angina
        if (data.exang === 1) {
          score += 1.2;
          riskFactors.push("Exercise Induced Angina");
        }

        // 8. Oldpeak
        score += data.oldpeak * 0.6;
        if (data.oldpeak > 1.5)
          riskFactors.push("High ST Depression (Oldpeak)");

        // 9. CA
        score += data.ca * 0.8;
        if (data.ca > 0) riskFactors.push(`${data.ca} Blocked/Colored Vessels`);

        // 10. Thalach
        score -= (data.thalach - 100) * 0.015;
        if (data.thalach < 130 && data.thalach > 0)
          riskFactors.push("Low Max Heart Rate");

        // 11. Thal
        if (data.thal === 3) {
          score += 0.6;
          riskFactors.push("Reversible Thalassemia Defect");
        }

        // Sigmoid-ish Clamp to 0-100%
        let probability = 1 / (1 + Math.exp(-(score - 1.5)));
        let percentage = Math.round(probability * 100);

        // Safety clamp
        if (isNaN(percentage)) percentage = 0;

        return {
          percentage: percentage,
          riskFactors: riskFactors,
          rawScore: score.toFixed(2),
        };
      };

      const InputField = ({
        label,
        value,
        onChange,
        type = "number",
        min,
        max,
        step,
        options,
        icon: Icon,
      }) => (
        <div className="mb-4">
          <label className="block text-sm font-medium text-gray-700 mb-1 flex items-center gap-2">
            {Icon && <Icon size={16} className="text-blue-600" />}
            {label}
          </label>
          {options ? (
            <select
              value={value}
              onChange={(e) => onChange(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all bg-white"
            >
              {options.map((opt) => (
                <option key={opt.value} value={opt.value}>
                  {opt.label}
                </option>
              ))}
            </select>
          ) : type === "range" ? (
            <div className="flex items-center gap-4">
              <input
                type="range"
                min={min}
                max={max}
                step={step || 1}
                value={Number(value) || min || 0}
                onChange={(e) => onChange(e.target.value)}
                className="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
              />
              <input
                type="number"
                min={min}
                max={max}
                step={step || "any"}
                value={value}
                onChange={(e) => onChange(e.target.value)}
                className="w-20 p-2 text-right border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-sm font-medium"
              />
            </div>
          ) : (
            <input
              type={type}
              value={value}
              onChange={(e) => onChange(e.target.value)}
              className="w-full p-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none transition-all"
              min={min}
              max={max}
              step={step}
            />
          )}
        </div>
      );

      const App = () => {
        const [formData, setFormData] = useState({
          age: 51,
          sex: 1,
          cp: 0,
          trestbps: 120,
          chol: 200,
          fbs: 0,
          restecg: 0,
          thalach: 150,
          exang: 0,
          oldpeak: 0,
          slope: 1,
          ca: 0,
          thal: 2,
        });

        const [result, setResult] = useState(null);
        const [isAnalyzing, setIsAnalyzing] = useState(false);

        const updateField = (field, value) => {
          setFormData((prev) => ({ ...prev, [field]: value }));
          if (result) setResult(null);
        };

        const handlePredict = () => {
          setIsAnalyzing(true);
          setTimeout(() => {
            const prediction = calculateRiskScore(formData);
            setResult(prediction);
            setIsAnalyzing(false);
          }, 800);
        };

        return (
          <div className="min-h-screen flex flex-col items-center justify-center p-4 md:p-8">
            {/* Header */}
            <div className="text-center mb-8 slide-in">
              <div className="inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4 shadow-sm">
                <Heart className="text-red-600 w-8 h-8" fill="currentColor" />
              </div>
              <h1 className="text-3xl md:text-4xl font-bold text-gray-900 mb-2">
                Heart Disease Predictor
              </h1>
              <p className="text-gray-500 max-w-lg mx-auto">
                Enter patient metrics below. The logic is calibrated to the UCI
                Heart Disease dataset patterns.
              </p>
            </div>

            <div className="flex flex-col lg:flex-row gap-8 w-full max-w-6xl">
              {/* Left Column: Input Form */}
              <div
                className="flex-1 bg-white p-6 rounded-2xl shadow-xl border border-gray-100 slide-in"
                style={{ animationDelay: "0.1s" }}
              >
                <h2 className="text-xl font-semibold text-gray-800 mb-6 flex items-center gap-2 border-b pb-3">
                  <User size={20} /> Patient Metrics
                </h2>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <InputField
                    label="Age (Years)"
                    icon={User}
                    value={formData.age}
                    onChange={(v) => updateField("age", v)}
                    type="range"
                    min={20}
                    max={90}
                  />
                  <InputField
                    label="Sex"
                    icon={User}
                    value={formData.sex}
                    onChange={(v) => updateField("sex", v)}
                    options={[
                      { value: 1, label: "Male" },
                      { value: 0, label: "Female" },
                    ]}
                  />
                  <InputField
                    label="Chest Pain Type (CP)"
                    icon={AlertCircle}
                    value={formData.cp}
                    onChange={(v) => updateField("cp", v)}
                    options={[
                      { value: 0, label: "Typical Angina (High Risk)" },
                      { value: 1, label: "Atypical Angina" },
                      { value: 2, label: "Non-anginal Pain" },
                      { value: 3, label: "Asymptomatic" },
                    ]}
                  />
                  <InputField
                    label="Resting Blood Pressure (mm Hg)"
                    icon={Activity}
                    value={formData.trestbps}
                    onChange={(v) => updateField("trestbps", v)}
                    type="range"
                    min={90}
                    max={200}
                  />
                  <InputField
                    label="Cholesterol (mg/dl)"
                    icon={Thermometer}
                    value={formData.chol}
                    onChange={(v) => updateField("chol", v)}
                    type="range"
                    min={120}
                    max={550}
                  />
                  <InputField
                    label="Fasting Blood Sugar > 120 mg/dl"
                    icon={Zap}
                    value={formData.fbs}
                    onChange={(v) => updateField("fbs", v)}
                    options={[
                      { value: 1, label: "True" },
                      { value: 0, label: "False" },
                    ]}
                  />
                  <InputField
                    label="Max Heart Rate (Thalach)"
                    icon={Activity}
                    value={formData.thalach}
                    onChange={(v) => updateField("thalach", v)}
                    type="range"
                    min={70}
                    max={220}
                  />
                  <InputField
                    label="Exercise Induced Angina"
                    icon={Wind}
                    value={formData.exang}
                    onChange={(v) => updateField("exang", v)}
                    options={[
                      { value: 1, label: "Yes" },
                      { value: 0, label: "No" },
                    ]}
                  />
                  <InputField
                    label="ST Depression (Oldpeak)"
                    icon={Activity}
                    value={formData.oldpeak}
                    onChange={(v) => updateField("oldpeak", v)}
                    type="range"
                    min={0}
                    max={6}
                    step={0.1}
                  />
                  <InputField
                    label="Major Vessels (CA)"
                    icon={Info}
                    value={formData.ca}
                    onChange={(v) => updateField("ca", v)}
                    type="range"
                    min={0}
                    max={4}
                  />
                  <InputField
                    label="Thalassemia"
                    icon={Info}
                    value={formData.thal}
                    onChange={(v) => updateField("thal", v)}
                    options={[
                      { value: 1, label: "Fixed Defect" },
                      { value: 2, label: "Normal" },
                      { value: 3, label: "Reversible Defect" },
                    ]}
                  />
                </div>

                <button
                  onClick={handlePredict}
                  disabled={isAnalyzing}
                  className={`w-full mt-8 py-4 rounded-xl text-white font-bold text-lg shadow-lg transition-all transform hover:scale-[1.02] active:scale-95 ${
                    isAnalyzing
                      ? "bg-gray-400 cursor-not-allowed"
                      : "bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700"
                  }`}
                >
                  {isAnalyzing
                    ? "Analyzing Clinical Data..."
                    : "Predict Risk Factor"}
                </button>
              </div>

              {/* Right Column: Results */}
              <div className="lg:w-1/3 flex flex-col gap-6">
                {/* Result Card */}
                <div
                  className={`bg-white p-6 rounded-2xl shadow-xl border border-gray-100 transition-all duration-500 ${
                    result
                      ? "opacity-100 translate-y-0"
                      : "opacity-50 translate-y-4"
                  }`}
                >
                  <h2 className="text-xl font-semibold text-gray-800 mb-4">
                    Analysis Result
                  </h2>

                  {result ? (
                    <div className="text-center">
                      <div className="relative w-48 h-48 mx-auto mb-6">
                        {/* Custom Gauge SVG */}
                        <svg className="w-full h-full" viewBox="0 0 36 36">
                          <path
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke="#eee"
                            strokeWidth="3"
                          />
                          <path
                            d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"
                            fill="none"
                            stroke={
                              result.percentage > 50 ? "#ef4444" : "#22c55e"
                            }
                            strokeWidth="3"
                            strokeDasharray={`${result.percentage || 0}, 100`}
                            className="animate-[dash_1s_ease-in-out_forwards]"
                          />
                        </svg>
                        <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
                          <span
                            className={`text-4xl font-bold ${
                              result.percentage > 50
                                ? "text-red-600"
                                : "text-green-600"
                            }`}
                          >
                            {result.percentage}%
                          </span>
                          <p className="text-xs text-gray-500 font-medium uppercase mt-1">
                            Probability
                          </p>
                        </div>
                      </div>

                      <div
                        className={`p-4 rounded-lg mb-4 ${
                          result.percentage > 50
                            ? "bg-red-50 text-red-800"
                            : "bg-green-50 text-green-800"
                        }`}
                      >
                        <h3 className="font-bold text-lg">
                          {result.percentage > 70
                            ? "High Probability"
                            : result.percentage > 40
                            ? "Moderate Risk"
                            : "Low Probability"}
                        </h3>
                        <p className="text-sm opacity-90">
                          {result.percentage > 50
                            ? "The provided metrics align with patterns associated with heart disease in the dataset."
                            : "The provided metrics align with healthy patient profiles in the dataset."}
                        </p>
                      </div>

                      {result.riskFactors.length > 0 && (
                        <div className="text-left mt-4">
                          <p className="text-xs font-bold text-gray-400 uppercase mb-2">
                            Contributing Factors
                          </p>
                          <ul className="space-y-2">
                            {result.riskFactors.map((factor, idx) => (
                              <li
                                key={idx}
                                className="flex items-center gap-2 text-sm text-gray-700 bg-gray-50 p-2 rounded"
                              >
                                <AlertCircle
                                  size={14}
                                  className="text-amber-500"
                                />
                                {factor}
                              </li>
                            ))}
                          </ul>
                        </div>
                      )}
                    </div>
                  ) : (
                    <div className="flex flex-col items-center justify-center h-64 text-gray-400">
                      <Activity size={48} className="mb-2 opacity-20" />
                      <p>Enter metrics and predict to see results</p>
                    </div>
                  )}
                </div>

                {/* Info Card */}
                <div className="bg-blue-50 p-6 rounded-2xl border border-blue-100">
                  <div className="flex items-start gap-3">
                    <Info className="text-blue-600 shrink-0 mt-1" size={20} />
                    <div>
                      <h3 className="font-semibold text-blue-900 mb-1">
                        Model Logic
                      </h3>
                      <p className="text-sm text-blue-800 leading-relaxed">
                        This tool uses a weighted scoring algorithm derived from
                        the correlations in the `heart.csv` dataset. Note that
                        in this specific dataset,{" "}
                        <strong>Exercise Angina</strong> and{" "}
                        <strong>Number of Vessels (CA)</strong> are strong
                        indicators.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <footer className="mt-12 text-center text-gray-400 text-sm pb-8">
              <p>
                Â© 2024 Heart Prediction Logic. For informational purposes only.
                Consult a doctor.
              </p>
            </footer>
          </div>
        );
      };

      ReactDOM.createRoot(document.getElementById("root")).render(<App />);
    </script>
  </body>
</html>
